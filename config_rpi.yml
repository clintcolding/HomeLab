- hosts: all
  remote_user: pi
  become: yes

  tasks:
  # Allows full monitoring of rpi memory
  - name: Copy cmdline.txt file
    copy:
      src: ./files/cmdline.txt
      dest: /boot/cmdline.txt
      force: yes

  - name: Update packages
    apt:
      update_cache: yes
      cache_valid_time: 3600

  - name: Install aptitude
    apt:
      name: aptitude

  - name: Install docker prereqs
    apt:
      name: "{{ packages }}"
    vars:
      packages:
        - apt-transport-https
        - ca-certificates
        - software-properties-common

  - name: Add docker GPG Key
    apt_key:
      url: https://download.docker.com/linux/raspbian/gpg

  - name: Add docker repo
    apt_repository:
      repo: deb [arch=armhf] https://download.docker.com/linux/raspbian stretch stable

  - name: Install docker-ce
    apt:
      name: "{{ packages }}"
    vars:
      packages:
        - docker-ce
        - docker-ce-cli
        - containerd.io
